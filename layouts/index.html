{{ partial "head.html" . }}
<body>
    {{ partial "header.html" . }}
    
    <main class="container">
        {{/* Include filter controls */}}
        {{ partial "filters.html" . }}
        
        <div class="camera-grid" id="camera-grid">
            {{ $cameras := partial "camera-data.html" . }}
            {{ range $cameras }}
                {{/* Find latest snapshot for this camera - move before link */}}
                {{ $imageDir := printf "static/images/%s" .id }}
                {{ $latestSnapshot := "" }}
                {{ $latestFilename := "" }}
                {{ with os.ReadDir $imageDir }}
                    {{/* Sort files by name in reverse (latest first) */}}
                    {{ $files := sort . "Name" "desc" }}
                    {{ range $files }}
                        {{ if not .IsDir }}
                            {{ if strings.HasSuffix .Name ".webp" }}
                                {{ if eq $latestSnapshot "" }}
                                    {{ $latestSnapshot = printf "%s/%s" $imageDir .Name }}
                                    {{ $latestFilename = .Name }}
                                {{ end }}
                            {{ end }}
                        {{ end }}
                    {{ end }}
                {{ end }}
                
                <a href="/cameras/{{ .id }}/" class="camera-card-link" aria-label="Camera: {{ .name }}, Direction: {{ if .direction }}{{ .direction }}{{ else }}Direction unavailable{{ end }}, Last updated: {{ if $latestFilename }}see timestamp{{ else }}Timestamp unavailable{{ end }}" tabindex="0">
                <article class="camera-card" 
                         data-camera-id="{{ .id }}" 
                         data-camera-name="{{ .name }}" 
                         data-camera-direction="{{ .direction }}">
                    <div class="card-content">
                        
                        {{ if $latestSnapshot }}
                            <img src="/images/{{ .id }}/{{ $latestFilename }}" alt="{{ .name }} - {{ .direction }}" loading="lazy">
                        {{ else }}
                            <div class="image-placeholder">
                                <svg class="icon-camera-off" width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 9C13.66 9 15 10.34 15 12C15 13.66 13.66 15 12 15C10.34 15 9 13.66 9 12C9 10.34 10.34 9 12 9ZM12 7C9.24 7 7 9.24 7 12C7 14.76 9.24 17 12 17C14.76 17 17 14.76 17 12C17 9.24 14.76 7 12 7ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" fill="#808080"/>
                                </svg>
                                <p class="unavailable" style="font-size: 16px; text-align: center; margin-top: 8px;">Image unavailable</p>
                            </div>
                        {{ end }}
                        
                        <div class="camera-metadata">
                            <h2 class="camera-name" {{ if gt (len .name) 40 }}title="{{ .name }}"{{ end }}>{{ .name }}</h2>
                            <div class="camera-info-row">
                                {{ if .direction }}
                                    <span class="direction-pill-card">
                                        <svg class="direction-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 2L15.5 8.5L22 12L15.5 15.5L12 22L8.5 15.5L2 12L8.5 8.5L12 2Z" fill="currentColor" opacity="0.8"/>
                                        </svg>
                                        {{ .direction }}
                                    </span>
                                {{ else }}
                                    <span class="unavailable">Direction unavailable</span>
                                {{ end }}
                            </div>
                            <p class="camera-timestamp" data-timestamp="{{ $latestFilename }}">{{ if $latestFilename }}Loading...{{ else }}<span class="unavailable">Timestamp unavailable</span>{{ end }}</p>
                        </div>
                    </div>
                </article>
                </a>
            {{ end }}
        </div>
    </main>
    
    {{ partial "footer.html" . }}
    
    {{/* Include JavaScript */}}
    {{ $js := resources.Get "js/main.js" | minify }}
    <script src="{{ $js.RelPermalink }}"></script>
</body>
</html>
